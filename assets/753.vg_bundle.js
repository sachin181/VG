"use strict";(self.webpackChunkcustom_vf_nextjs=self.webpackChunkcustom_vf_nextjs||[]).push([[753],{1753:(n,t,e)=>{e.r(t),e.d(t,{default:()=>_});var o=e(2167),i=e(5861),r=e(885),u=e(4687),a=e.n(u),l=e(1194),c=e(7294),g=e(1721),s=e.n(g),v=e(3068),f=e(7619),d=e(7828),p=e(2280),b=e(9352),m=e(7479),h=e(155),y=e(8676),k=e(381),w=e.n(k),O=e(8650),x=e(3711),D=c.createElement;function N(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,o)}return e}function j(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?N(Object(e),!0).forEach((function(t){(0,o.Z)(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):N(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}const _=function(n){var t,e,o,u,g,k=(0,y.useRuntime)(),N=k.runtime,_=k.confirmedBucket,E=k.setRuntime,I=((0,m.F)().getColor,c.useState({})),P=(0,r.Z)(I,2),C=P[0],S=P[1],Z=c.useState(null),M=(0,r.Z)(Z,2),T=M[0],R=M[1],q=c.useState("init"),A=(0,r.Z)(q,2),B=A[0],J=A[1];function F(){return(F=(0,i.Z)(a().mark((function t(){var e,o,i,r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("".concat((0,l.MC)({region:"voiceglow-eu"===_?"eu":"na"}),"/public/users/").concat(null===(e=n.agentData)||void 0===e?void 0:e.ownerID)).then((function(n){return n.json()}));case 2:i=t.sent,S(i.data),r=new(s())(null===(o=i.data)||void 0===o||null===(o=o.vapiConfig)||void 0===o?void 0:o.PUBLIC_API_KEY),R(r);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return c.useEffect((function(){if(T)return T.on("call-start",(function(){J("ongoing"),E((function(n){return j(j({},n),{},{callOngoing:!0})}))})),T.on("speech-end",(function(){})),T.on("speech-start",(function(){})),T.on("call-end",(function(){J("init"),E((function(n){return j(j({},n),{},{callOngoing:!1})}))})),T.on("volume-level",(function(n){})),T.on("message",function(){var n=(0,i.Z)(a().mark((function n(t){var e,o,i;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("conversation-update"!==t.type){n.next=5;break}return o=t.conversation.map((function(n){return{from:"assistant"===n.role?"bot":"human",messages:[{from:"assistant"===n.role?"bot":"human",type:"text",item:{payload:{message:n.content}},ts:w()().unix()}],ts:w()().unix()}})),i=(0,O.getFirestore)(x.l2,_),n.next=5,(0,O.setDoc)((0,O.doc)(i,"voiceglow/".concat(null==N||null===(e=N.variables)||void 0===e?void 0:e.ID,"/convos/").concat(N.userID,"/convo/JSON_STRING")),{convoTurns_JSON_STRING:JSON.stringify(o)});case 5:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}()),T.on("error",(function(n){E((function(n){return j(j({},n),{},{callOngoing:!1})}))})),function(){T.stop(),E((function(n){return j(j({},n),{},{callOngoing:!1})}))}}),[T]),c.useEffect((function(){!function(){F.apply(this,arguments)}()}),[]),null!=C&&null!==(t=C.vapiConfig)&&void 0!==t&&t.PUBLIC_API_KEY?D(f.E.div,{key:"vg-voice--container",initial:{opacity:1,bottom:"init"===B?"-30%":"0%",height:"35%"},animate:{opacity:1,bottom:0,height:"init"===B?"40%":"35%"},exit:{opacity:1,bottom:"init"===B?"-35%":"0%",height:"35%"},transition:{type:"spring",damping:20,stiffness:100,mass:.5},className:" vg-py-unit-5 vg-h-full vg-flex vg-flex-col vg-gap-0 vg-justify-center vg-items-center vg-absolute vg-left-0 vg-w-full vg-bg-background/50 vg-backdrop-blur vg-z-[9999] vg-px-unit-20 vg-mx-auto vg-text-center vg-border-t vg-border-foreground-100 vg-voice--container"},D(d.M,null,"init"===B?D(f.E.div,{className:" vg-mb-unit-4 ",layout:!0,key:"vg-voice--question_".concat(null===(e=n.agentData)||void 0===e?void 0:e.ID)},D(p.Z,{className:" vg-text-large vg-font-bold vg-leading-6 vg-voice--question"},(null===(o=n.agentData)||void 0===o||null===(o=o.ui)||void 0===o||null===(o=o.voice)||void 0===o?void 0:o.question)||"Would you like to talk in realtime with an AI agent?")):null,D(f.E.button,{key:"vg-voice--yes-please_".concat(null===(u=n.agentData)||void 0===u?void 0:u.ID),layout:!0,animate:{scale:"init"===B?1:"starting"===B?1.05:"ongoing"===B?1.1:1},whileHover:{scale:1.1},className:" vg-border vg-border-foreground-200 ".concat("init"===B?" vg-bg-background-500 ":"starting"===B?" vg-bg-background-600 ":"ongoing"===B?" vg-bg-danger-500 ":" vg-bg-background-500 "," vg-mb-unit-5 vg-rounded-full vg-w-unit-20 vg-h-unit-20 vg-p-unit-5 vg-font-bold vg-transition-colors vg-voice--yes-button"),onClick:function(){var t;"init"!==B?T.isMuted()?(T.setMuted(!1),J("ongoing")):(T.setMuted(!0),J("muted")):(J("starting"),T.start(null===(t=n.agentData)||void 0===t||null===(t=t.vapi)||void 0===t?void 0:t.id))}},"starting"===B?D(v.Z,{className:" vg-w-full vg-h-full "}):null,"init"===B?D(b.xEs,{className:" vg-w-full vg-h-full vg-flex-shrink-0 "}):null,"ongoing"===B?D(b.xEs,{className:" vg-w-full vg-h-full vg-flex-shrink-0 "}):null,"muted"===B?D(b._v3,{className:" vg-w-full vg-h-full vg-flex-shrink-0 "}):null),D(f.E.button,{key:"vg-voice--no-thanks_".concat(null===(g=n.agentData)||void 0===g?void 0:g.ID),layout:!0,className:" vg-border vg-border-foreground-100 vg-w-unit-8 vg-h-unit-8 vg-font-normal vg-opacity-80 vg-rounded-full vg-p-unit-1 vg-voice--no-button",onClick:function(){T&&T.stop(),n.onNoThanks&&n.onNoThanks()}},D(h.bjh,{className:" vg-w-full vg-h-full vg-flex-shrink-0 "})))):null}}}]);