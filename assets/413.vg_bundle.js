"use strict";(self.webpackChunkcustom_vf_nextjs=self.webpackChunkcustom_vf_nextjs||[]).push([[413],{1413:(e,n,t)=>{t.r(n),t.d(n,{default:()=>g});var a=t(5861),s=t(885),r=t(4687),u=t.n(r),o=t(8676),c=t(1148),l=t(7294),i=t(5392),d=t(3260),f=t(381),v=t.n(f),p=l.createElement;const g=function(e){var n=(0,o.useRuntime)(),t=n.confirmedBucket,r=n.runtime,f=l.useState(""),g=(0,s.Z)(f,2),m=g[0],x=g[1],b=l.useState(!1),k=(0,s.Z)(b,2),I=k[0],y=k[1];return l.useEffect((function(){if(m)y(!0);else{var n=new WebSocket("".concat((0,c.IO)({region:"voiceglow-eu"===t?"eu":"na"}),"/flowise")),s="";n.onopen=function(){var c;n.send(JSON.stringify({agentId:r.variables.ID,convoId:r.userID,flowisePayload:null===(c=e.message)||void 0===c||null===(c=c.item)||void 0===c?void 0:c.payload,bucket:t})),n.onmessage=function(e){try{var n,t=JSON.parse(e.data);"chunk"===t.type&&null!=t&&null!==(n=t.payload)&&void 0!==n&&n.chunk&&(x((function(e){return e+t.payload.chunk})),s+=t.payload.chunk)}catch(e){}},n.onclose=(0,a.Z)(u().mark((function n(){return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,s){n.next=3;break}return n.abrupt("return");case 3:return n.next=5,(0,o.handlePushMessageNoInteract)({agentID:r.variables.ID,userID:r.userID,action:null,origin:"web-chat",messages:[{type:"text",item:{payload:{message:s}},ts:v()().unix(),from:"bot",mask:{turnIndex:e.turnIndex,messageIndex:e.messageIndex}}],bucket:t,vf_variables:{flowise_response:s}});case 5:n.next=9;break;case 7:n.prev=7,n.t0=n.catch(0);case 9:case"end":return n.stop()}}),n,null,[[0,7]])})))}}}),[]),m&&!I?p(d.Z,{className:" vg-p-6 vg-rounded-tl-[25px] vg-rounded-bl-[25px] vg-rounded-tr-[25px] vg-rounded-br-[5px] vg-justify-self-end vg-message-text-bot",item:{type:"text",payload:{message:""},ts:v()().unix(),from:"bot"},text:m,key:"flowise_res_".concat(e.turnIndex,"_").concat(e.messageIndex)}):I?null:p(i.default,{variant:"no-avatar"})}}}]);